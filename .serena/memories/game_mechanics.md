# ゲームメカニクス

## キャラクターシステム

### プレイヤーキャラクター（4種）

| キャラ | スキル | 効果 | 使用回数 | 解放条件 |
|--------|--------|------|----------|----------|
| 勇者 | ダッシュ | 2マス移動 | 5回/試合 | 初期 |
| 盗賊 | 斜め移動 | 斜め方向移動可能 | 5回/試合 | 階層10クリア |
| 魔法使い | 透明化 | 鬼に当たっても無敵 | 5回/試合 | 有料¥240 |
| エルフ | 拘束 | 鬼を1ターン停止 | 5回/試合 | 有料¥240 |

**重要**: 全キャラのスキル使用回数は5回/試合（Constants.maxSkillUsage）

### 鬼キャラクター（階層で自動変化）
- 赤鬼: 階層1-25
- 青鬼: 階層26-50
- 骸骨: 階層51-75
- ドラゴン: 階層76-100

## ゲームルール

### 基本ルール
- 3×3グリッド（9マス）
- 音楽のビートに合わせて移動
- 10ターン逃げ切りで次の階層へ
- 鬼と同じマスに入ると敗北
- タイミングミス（ビートから外れる）でも敗北

### 移動
- 基本: 縦横斜め8方向、1マス移動
- ビートのタイミングで移動（±15%の誤差許容）
- プレイヤーと鬼が同時移動

## BPMシステム

### 階層別BPM（改善版: 80→180）
- 階層1-10: BPM 80
- 階層11-20: BPM 90
- 階層21-30: BPM 100
- ...
- 階層91-100: BPM 180

**10階層ごとに10BPM上昇** (Constants.bpmIncrement = 10.0)

### タイミング判定
- 許容誤差: ±15% (Constants.timingTolerance = 0.15)
- チェック間隔: 10ms (Constants.beatCheckInterval = 0.01)

## 特殊ルール（階層で自動発動）

| 階層 | 特殊ルール | 効果 |
|------|-----------|------|
| 1-20 | なし | 通常 |
| 21-40 | 霧マップ | 周囲が見えない |
| 41-60 | マス消失 | ランダムで1マス消える |
| 61-100 | 霧+消失 | 両方発動 |

定数:
- `Constants.fogStartFloor = 21`
- `Constants.disappearStartFloor = 41`
- `Constants.combinedRulesStartFloor = 61`

## AI難易度（ゲーム開始時に選択）

### Easy（易しい）
- 70%でランダム、30%で追跡
- 初心者向け

### Normal（普通）
- 基本的な追跡
- 最短距離で近づく
- 標準的な難易度

### Hard（難しい）
- 高度な戦略
- プレイヤーの次の手を予測
- 上級者向け

## スキルシステム

### スキルリセット
- 10階層ごとにスキル使用回数がリセット（Constants.skillResetInterval = 10）

### 連続待機制限
- 最大2回まで連続待機可能（Constants.maxConsecutiveWaits = 2）

## スコアシステム
- **スコア = 到達階層数**
- 100階層が最高スコア
- ランキング: Game Center連携

## グリッドシステム

### 座標計算
```
1  2  3
4  5  6
7  8  9
```

ヘルパー関数（Constants内）:
- `rowFromPosition(_ position: Int) -> Int`
- `columnFromPosition(_ position: Int) -> Int`
- `positionFromRowColumn(row: Int, column: Int) -> Int`
