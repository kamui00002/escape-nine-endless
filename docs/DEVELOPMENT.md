# DEVELOPMENT.md - Escape Nine: Endless

## ğŸ“˜ é–‹ç™ºè€…å‘ã‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯Cursorã§ã®é–‹ç™ºã‚’åŠ¹ç‡åŒ–ã™ã‚‹ãŸã‚ã®æŠ€è¡“ä»•æ§˜æ›¸ã§ã™ã€‚

---

## ç›®æ¬¡
1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †)
4. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
5. [ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„](#ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„)
6. [éŸ³æ¥½åŒæœŸã‚·ã‚¹ãƒ†ãƒ ](#éŸ³æ¥½åŒæœŸã‚·ã‚¹ãƒ†ãƒ )
7. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ)
8. [çŠ¶æ…‹ç®¡ç†](#çŠ¶æ…‹ç®¡ç†)
9. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
10. [å®Ÿè£…å„ªå…ˆé †ä½](#å®Ÿè£…å„ªå…ˆé †ä½)

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

### åŸºæœ¬æƒ…å ±
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: escape-nine-endless
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å**: com.souatou.escapenine
- **æœ€å°iOS**: 14.0
- **é–‹ç™ºè¨€èª**: TypeScript
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: React Native + Expo

### ã‚²ãƒ¼ãƒ ã®æ ¸å¿ƒ
- **éŸ³æ¥½åŒæœŸ**: ãƒ“ãƒ¼ãƒˆã«åˆã‚ã›ãŸç§»å‹•åˆ¤å®šãŒæœ€é‡è¦
- **ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹**: 100éšå±¤ã¾ã§ã®ã‚¹ã‚³ã‚¢ã‚¢ã‚¿ãƒƒã‚¯
- **ã‚·ãƒ³ãƒ—ãƒ«**: ã‚¹ã‚¿ãƒŸãƒŠãƒ»ã‚³ã‚¤ãƒ³ãƒ»è¤‡é›‘ãªè¦ç´ ãªã—

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **React Native**: 0.73.x
- **Expo**: SDK 50.x
- **TypeScript**: 5.x
- **React Navigation**: 6.x
- **React Native Paper**: 5.x
- **React Native Reanimated**: 3.x

### éŸ³æ¥½ãƒ»éŸ³å£°
- **Expo AV**: éŸ³æ¥½å†ç”Ÿã€BPMåŒæœŸ
- **React Native Sound**: åŠ¹æœéŸ³(è»½é‡)

### çŠ¶æ…‹ç®¡ç†
- **Zustand**: 4.x

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Firebase**:
  - Authentication
  - Firestore (ãƒ©ãƒ³ã‚­ãƒ³ã‚°)
  - Analytics
- **Google AdMob**: åºƒå‘Š
- **Expo In-App Purchases**: èª²é‡‘
- **Game Center**: ãƒ©ãƒ³ã‚­ãƒ³ã‚°

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
npx create-expo-app escape-nine --template blank-typescript
cd escape-nine

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
npm install @react-navigation/native @react-navigation/stack
npm install react-native-paper
npm install zustand
npm install firebase
npm install @react-native-async-storage/async-storage
npm install expo-av
npm install react-native-reanimated

# Expoé–¢é€£
npx expo install expo-dev-client
npx expo install react-native-safe-area-context react-native-screens
npx expo install expo-game-center

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm start
```

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
escape-nine/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ HomeScreen.tsx
â”‚   â”‚   â”œâ”€â”€ GameScreen.tsx          # ãƒ¡ã‚¤ãƒ³ç”»é¢
â”‚   â”‚   â”œâ”€â”€ ResultScreen.tsx
â”‚   â”‚   â”œâ”€â”€ RankingScreen.tsx
â”‚   â”‚   â”œâ”€â”€ ShopScreen.tsx
â”‚   â”‚   â”œâ”€â”€ PracticeScreen.tsx
â”‚   â”‚   â””â”€â”€ SettingsScreen.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Grid/
â”‚   â”‚   â”‚   â”œâ”€â”€ GridBoard.tsx       # 9ãƒã‚¹ç›¤é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ GridCell.tsx
â”‚   â”‚   â”‚   â””â”€â”€ BeatIndicator.tsx  # ãƒ“ãƒ¼ãƒˆè¡¨ç¤º
â”‚   â”‚   â”œâ”€â”€ Character/
â”‚   â”‚   â”‚   â”œâ”€â”€ CharacterSprite.tsx
â”‚   â”‚   â”‚   â””â”€â”€ CharacterSelect.tsx
â”‚   â”‚   â”œâ”€â”€ UI/
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Modal.tsx
â”‚   â”‚   â””â”€â”€ Ad/
â”‚   â”‚       â”œâ”€â”€ BannerAd.tsx
â”‚   â”‚       â””â”€â”€ InterstitialAd.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ gameStore.ts            # ã‚²ãƒ¼ãƒ çŠ¶æ…‹
â”‚   â”‚   â”œâ”€â”€ playerStore.ts          # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿
â”‚   â”‚   â””â”€â”€ rankingStore.ts         # ãƒ©ãƒ³ã‚­ãƒ³ã‚°
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useBeatSync.ts          # éŸ³æ¥½åŒæœŸ(æœ€é‡è¦)
â”‚   â”‚   â”œâ”€â”€ useGame.ts
â”‚   â”‚   â””â”€â”€ useRanking.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ GameEngine.ts           # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ AIEngine.ts             # AIåˆ¶å¾¡
â”‚   â”‚   â”œâ”€â”€ BeatEngine.ts           # éŸ³æ¥½åŒæœŸã‚¨ãƒ³ã‚¸ãƒ³(æœ€é‡è¦)
â”‚   â”‚   â”œâ”€â”€ StageManager.ts         # éšå±¤ç®¡ç†
â”‚   â”‚   â””â”€â”€ RankingService.ts       # ãƒ©ãƒ³ã‚­ãƒ³ã‚°
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ constants.ts
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â””â”€â”€ helpers.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ firebase.ts
â”‚   â”‚   â”œâ”€â”€ admob.ts
â”‚   â”‚   â””â”€â”€ gameConfig.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ images/characters/
â”‚   â”‚   â”œâ”€â”€ sounds/bgm/             # BPMåˆ¥BGM
â”‚   â”‚   â”œâ”€â”€ sounds/sfx/
â”‚   â”‚   â””â”€â”€ fonts/
â”‚   â”‚
â”‚   â””â”€â”€ navigation/
â”‚       â””â”€â”€ AppNavigator.tsx
â”‚
â”œâ”€â”€ App.tsx
â”œâ”€â”€ app.json
â””â”€â”€ package.json
```

---

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### TypeScriptè¦ç´„

```typescript
// âœ… Good: æ˜ç¤ºçš„ãªå‹å®šç¾©
interface Character {
  id: string;
  name: string;
  type: 'hero' | 'thief' | 'wizard' | 'elf';
  skill: Skill;
  spriteUrl: string;
}

// âœ… Good: Enumä½¿ç”¨
enum AILevel {
  EASY = 'easy',
  NORMAL = 'normal',
  HARD = 'hard',
}

// âœ… Good: Optional chaining
const skillCount = character?.skill?.usageCount;
```

### å‘½åè¦å‰‡

```typescript
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: PascalCase
GridBoard.tsx
BeatIndicator.tsx

// é–¢æ•°ãƒ»å¤‰æ•°: camelCase
const checkBeatTiming = () => {};
const currentBpm = 120;

// å®šæ•°: UPPER_SNAKE_CASE
const MAX_FLOORS = 100;
const GRID_SIZE = 9;

// å‹: PascalCase
interface GameState {}
type SkillType = 'dash' | 'diagonal' | 'invisible' | 'bind';
```

---

## éŸ³æ¥½åŒæœŸã‚·ã‚¹ãƒ†ãƒ 

### æœ€é‡è¦: BeatEngine.ts

```typescript
import { Audio } from 'expo-av';

export class BeatEngine {
  private sound: Audio.Sound | null = null;
  private bpm: number = 60;
  private beatInterval: number = 1000; // ãƒŸãƒªç§’
  private lastBeatTime: number = 0;
  private beatCallbacks: Array<() => void> = [];

  /**
   * BGMã‚’èª­ã¿è¾¼ã¿ã€BPMã‚’è¨­å®š
   */
  async loadMusic(bpm: number) {
    this.bpm = bpm;
    this.beatInterval = (60 / bpm) * 1000; // BPMã‹ã‚‰ãƒ“ãƒ¼ãƒˆé–“éš”ã‚’è¨ˆç®—

    // BGMãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    const { sound } = await Audio.Sound.createAsync(
      require(`@/assets/sounds/bgm/bgm_${bpm}.mp3`)
    );
    this.sound = sound;
  }

  /**
   * BGMå†ç”Ÿé–‹å§‹
   */
  async play() {
    if (this.sound) {
      await this.sound.playAsync();
      this.startBeatDetection();
    }
  }

  /**
   * BGMåœæ­¢
   */
  async stop() {
    if (this.sound) {
      await this.sound.stopAsync();
    }
  }

  /**
   * ãƒ“ãƒ¼ãƒˆæ¤œå‡ºã‚’é–‹å§‹
   */
  private startBeatDetection() {
    this.lastBeatTime = Date.now();

    setInterval(() => {
      const now = Date.now();
      const elapsed = now - this.lastBeatTime;

      if (elapsed >= this.beatInterval) {
        this.onBeat();
        this.lastBeatTime = now;
      }
    }, 10); // 10msã”ã¨ã«ãƒã‚§ãƒƒã‚¯
  }

  /**
   * ãƒ“ãƒ¼ãƒˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ç™»éŒ²
   */
  onBeatCallback(callback: () => void) {
    this.beatCallbacks.push(callback);
  }

  /**
   * ãƒ“ãƒ¼ãƒˆãŒæ¥ãŸæ™‚ã®å‡¦ç†
   */
  private onBeat() {
    this.beatCallbacks.forEach(cb => cb());
  }

  /**
   * ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¤å®š(ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›ãŒæ­£ã—ã„ã‹)
   */
  checkTiming(inputTime: number): boolean {
    const timeDiff = Math.abs(inputTime - this.lastBeatTime);
    const tolerance = this.beatInterval * 0.15; // Â±15%ã®èª¤å·®ã‚’è¨±å®¹

    return timeDiff <= tolerance;
  }

  /**
   * BPMã‚’å¤‰æ›´(éšå±¤ãŒä¸ŠãŒã£ãŸæ™‚)
   */
  changeBPM(newBpm: number) {
    this.bpm = newBpm;
    this.beatInterval = (60 / newBpm) * 1000;
    // BGMã‚‚åˆ‡ã‚Šæ›¿ãˆã‚‹å¿…è¦ã‚ã‚Š
  }
}
```

### useBeatSync.ts (ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯)

```typescript
import { useEffect, useState } from 'react';
import { BeatEngine } from '@/services/BeatEngine';

export const useBeatSync = (bpm: number) => {
  const [beatEngine] = useState(() => new BeatEngine());
  const [currentBeat, setCurrentBeat] = useState(0);

  useEffect(() => {
    // BPMã§BGMèª­ã¿è¾¼ã¿
    beatEngine.loadMusic(bpm);

    // ãƒ“ãƒ¼ãƒˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™»éŒ²
    beatEngine.onBeatCallback(() => {
      setCurrentBeat(prev => prev + 1);
    });

    // BGMå†ç”Ÿ
    beatEngine.play();

    return () => {
      beatEngine.stop();
    };
  }, [bpm]);

  /**
   * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç§»å‹•ã—ãŸæ™‚ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒã‚§ãƒƒã‚¯
   */
  const checkMoveTimin = () => {
    const inputTime = Date.now();
    const isCorrectTiming = beatEngine.checkTiming(inputTime);

    if (!isCorrectTiming) {
      // ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå¤–ã‚ŒãŸ = ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
      return false;
    }

    return true;
  };

  return {
    currentBeat,
    checkMoveTiming,
  };
};
```

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### GameScreen.tsx (æœ€é‡è¦)

```typescript
import React, { useState, useEffect } from 'react';
import { View, StyleSheet, TouchableOpacity } from 'react-native';
import { GridBoard } from '@/components/Grid/GridBoard';
import { BeatIndicator } from '@/components/Grid/BeatIndicator';
import { useBeatSync } from '@/hooks/useBeatSync';
import { useGameStore } from '@/stores/gameStore';

export const GameScreen: React.FC = () => {
  const {
    currentFloor,
    playerPosition,
    enemyPosition,
    gameStatus,
    moveCharacter,
    endGame,
  } = useGameStore();

  // éšå±¤ã«å¿œã˜ãŸBPMè¨ˆç®—
  const bpm = calculateBPM(currentFloor);
  const { currentBeat, checkMoveTiming } = useBeatSync(bpm);

  /**
   * ãƒã‚¹ã‚¿ãƒƒãƒ—æ™‚ã®å‡¦ç†
   */
  const handleCellPress = (position: number) => {
    // ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒã‚§ãƒƒã‚¯
    const isCorrectTiming = checkMoveTiming();
    if (!isCorrectTiming) {
      endGame('lose'); // ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒŸã‚¹ã§å³æ­»
      return;
    }

    // ç§»å‹•å®Ÿè¡Œ
    moveCharacter(position);
  };

  return (
    <View style={styles.container}>
      {/* éšå±¤è¡¨ç¤º */}
      <Text style={styles.floor}>Floor: {currentFloor}</Text>

      {/* ãƒ“ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */}
      <BeatIndicator currentBeat={currentBeat} />

      {/* 9ãƒã‚¹ã‚°ãƒªãƒƒãƒ‰ */}
      <GridBoard
        playerPosition={playerPosition}
        enemyPosition={enemyPosition}
        onCellPress={handleCellPress}
      />
    </View>
  );
};

/**
 * éšå±¤ã‹ã‚‰BPMã‚’è¨ˆç®—
 */
const calculateBPM = (floor: number): number => {
  if (floor <= 10) return 60;
  if (floor <= 20) return 80;
  if (floor <= 30) return 100;
  if (floor <= 40) return 120;
  if (floor <= 50) return 140;
  if (floor <= 60) return 160;
  if (floor <= 70) return 180;
  if (floor <= 80) return 200;
  if (floor <= 90) return 220;
  return 240;
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#1a1a2e',
    alignItems: 'center',
    justifyContent: 'center',
  },
  floor: {
    fontSize: 32,
    color: '#eaeaea',
    marginBottom: 20,
  },
});
```

### BeatIndicator.tsx (ãƒ“ãƒ¼ãƒˆè¡¨ç¤º)

```typescript
import React, { useEffect } from 'react';
import { View, StyleSheet, Animated } from 'react-native';

interface BeatIndicatorProps {
  currentBeat: number;
}

export const BeatIndicator: React.FC<BeatIndicatorProps> = ({ currentBeat }) => {
  const scaleAnim = new Animated.Value(1);

  useEffect(() => {
    // ãƒ“ãƒ¼ãƒˆã”ã¨ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    Animated.sequence([
      Animated.timing(scaleAnim, {
        toValue: 1.3,
        duration: 100,
        useNativeDriver: true,
      }),
      Animated.timing(scaleAnim, {
        toValue: 1,
        duration: 100,
        useNativeDriver: true,
      }),
    ]).start();
  }, [currentBeat]);

  return (
    <View style={styles.container}>
      <Animated.View
        style={[
          styles.indicator,
          { transform: [{ scale: scaleAnim }] },
        ]}
      />
      <Text style={styles.text}>â™ª Beat: {currentBeat}</Text>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    alignItems: 'center',
    marginBottom: 20,
  },
  indicator: {
    width: 60,
    height: 60,
    borderRadius: 30,
    backgroundColor: '#667eea',
  },
  text: {
    color: '#eaeaea',
    fontSize: 18,
    marginTop: 10,
  },
});
```

---

## çŠ¶æ…‹ç®¡ç†

### gameStore.ts

```typescript
import { create } from 'zustand';

interface GameState {
  // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
  currentFloor: number;
  turnCount: number;
  maxTurns: number;
  playerPosition: number;
  enemyPosition: number;
  gameStatus: 'playing' | 'win' | 'lose' | 'paused';
  aiLevel: 'easy' | 'normal' | 'hard';
  specialRule: 'none' | 'fog' | 'disappear' | 'fog_disappear';
  
  // ã‚¹ã‚­ãƒ«
  selectedCharacter: CharacterType;
  skillUsageCount: number;
  maxSkillUsage: number;
  
  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  startGame: (aiLevel: AILevel) => void;
  moveCharacter: (newPosition: number) => void;
  moveEnemy: () => void;
  useSkill: () => void;
  nextFloor: () => void;
  endGame: (result: 'win' | 'lose') => void;
}

export const useGameStore = create<GameState>((set, get) => ({
  // åˆæœŸå€¤
  currentFloor: 1,
  turnCount: 0,
  maxTurns: 10,
  playerPosition: 1,
  enemyPosition: 9,
  gameStatus: 'playing',
  aiLevel: 'normal',
  specialRule: 'none',
  selectedCharacter: 'hero',
  skillUsageCount: 0,
  maxSkillUsage: 5,

  startGame: (aiLevel) => {
    set({
      currentFloor: 1,
      turnCount: 0,
      gameStatus: 'playing',
      aiLevel,
      playerPosition: Math.floor(Math.random() * 9) + 1,
      enemyPosition: Math.floor(Math.random() * 9) + 1,
      skillUsageCount: 0,
    });
  },

  moveCharacter: (newPosition) => {
    const { playerPosition, enemyPosition } = get();

    // ç§»å‹•å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
    if (!GameEngine.isValidMove(playerPosition, newPosition)) {
      return;
    }

    set({ playerPosition: newPosition });

    // åŒã˜ãƒã‚¹ã«å…¥ã£ãŸã‚‰ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
    if (newPosition === enemyPosition) {
      get().endGame('lose');
      return;
    }

    // ã‚¿ãƒ¼ãƒ³é€²è¡Œ
    set(state => ({ turnCount: state.turnCount + 1 }));

    // æ•µã®ç§»å‹•
    get().moveEnemy();

    // 10ã‚¿ãƒ¼ãƒ³é€ƒã’åˆ‡ã£ãŸã‚‰æ¬¡ã®éšå±¤ã¸
    if (get().turnCount >= get().maxTurns) {
      get().nextFloor();
    }
  },

  moveEnemy: () => {
    const { enemyPosition, playerPosition, aiLevel } = get();
    const nextPosition = AIEngine.calculateNextMove(
      enemyPosition,
      playerPosition,
      aiLevel
    );

    set({ enemyPosition: nextPosition });

    if (nextPosition === get().playerPosition) {
      get().endGame('lose');
    }
  },

  useSkill: () => {
    const { selectedCharacter, skillUsageCount, maxSkillUsage } = get();

    if (skillUsageCount >= maxSkillUsage) {
      return; // ã‚¹ã‚­ãƒ«å›æ•°ä¸Šé™
    }

    // ã‚¹ã‚­ãƒ«åŠ¹æœã‚’é©ç”¨
    SkillManager.applySkill(selectedCharacter);

    set(state => ({ skillUsageCount: state.skillUsageCount + 1 }));
  },

  nextFloor: () => {
    const newFloor = get().currentFloor + 1;

    if (newFloor > 100) {
      get().endGame('win'); // 100éšå±¤ã‚¯ãƒªã‚¢
      return;
    }

    // éšå±¤ãŒå¤‰ã‚ã‚‹ã¨ç‰¹æ®Šãƒ«ãƒ¼ãƒ«ã‚‚å¤‰ã‚ã‚‹
    const newRule = StageManager.getSpecialRule(newFloor);

    set({
      currentFloor: newFloor,
      turnCount: 0,
      specialRule: newRule,
      playerPosition: Math.floor(Math.random() * 9) + 1,
      enemyPosition: Math.floor(Math.random() * 9) + 1,
      skillUsageCount: 0, // ã‚¹ã‚­ãƒ«ãƒªã‚»ãƒƒãƒˆ
    });
  },

  endGame: (result) => {
    set({ gameStatus: result });

    if (result === 'win' || result === 'lose') {
      // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¨˜éŒ²
      RankingService.submitScore(get().currentFloor);
    }
  },
}));
```

### playerStore.ts

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import AsyncStorage from '@react-native-async-storage/async-storage';

interface PlayerState {
  highestFloor: number;
  unlockedCharacters: CharacterType[];
  selectedCharacter: CharacterType;
  adRemoved: boolean;
  
  unlockCharacter: (character: CharacterType) => void;
  selectCharacter: (character: CharacterType) => void;
  updateHighestFloor: (floor: number) => void;
  removeAds: () => void;
}

export const usePlayerStore = create<PlayerState>()(
  persist(
    (set, get) => ({
      highestFloor: 0,
      unlockedCharacters: ['hero'],
      selectedCharacter: 'hero',
      adRemoved: false,

      unlockCharacter: (character) => {
        set(state => ({
          unlockedCharacters: [...state.unlockedCharacters, character],
        }));
      },

      selectCharacter: (character) => {
        set({ selectedCharacter: character });
      },

      updateHighestFloor: (floor) => {
        const current = get().highestFloor;
        if (floor > current) {
          set({ highestFloor: floor });

          // éšå±¤10ã§ç›—è³Šè§£æ”¾
          if (floor >= 10 && !get().unlockedCharacters.includes('thief')) {
            get().unlockCharacter('thief');
          }
        }
      },

      removeAds: () => {
        set({ adRemoved: true });
      },
    }),
    {
      name: 'player-storage',
      storage: AsyncStorage,
    }
  )
);
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### types.ts

```typescript
// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
export type CharacterType = 'hero' | 'thief' | 'wizard' | 'elf';

export interface Character {
  id: string;
  type: CharacterType;
  name: string;
  skill: Skill;
  isFree: boolean;
  price?: number;
  spriteUrl: string;
}

// ã‚¹ã‚­ãƒ«
export type SkillType = 'dash' | 'diagonal' | 'invisible' | 'bind';

export interface Skill {
  type: SkillType;
  name: string;
  description: string;
  maxUsage: number;
}

// AIé›£æ˜“åº¦
export type AILevel = 'easy' | 'normal' | 'hard';

// ç‰¹æ®Šãƒ«ãƒ¼ãƒ«
export type SpecialRule = 'none' | 'fog' | 'disappear' | 'fog_disappear';

// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
export interface GameState {
  currentFloor: number;
  turnCount: number;
  maxTurns: number;
  playerPosition: number;
  enemyPosition: number;
  gameStatus: 'playing' | 'win' | 'lose' | 'paused';
  aiLevel: AILevel;
  specialRule: SpecialRule;
  bpm: number;
}
```

---

## å®Ÿè£…å„ªå…ˆé †ä½

### ãƒ•ã‚§ãƒ¼ã‚º1: éŸ³æ¥½åŒæœŸã‚·ã‚¹ãƒ†ãƒ (æœ€å„ªå…ˆ)
```typescript
// 1. BeatEngineã®å®Ÿè£…
- [ ] BeatEngine.ts ä½œæˆ
- [ ] BGMèª­ã¿è¾¼ã¿ãƒ»å†ç”Ÿ
- [ ] ãƒ“ãƒ¼ãƒˆæ¤œå‡º
- [ ] ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¤å®š

// 2. useBeatSyncãƒ•ãƒƒã‚¯ã®å®Ÿè£…
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ä½œæˆ
- [ ] ãƒ“ãƒ¼ãƒˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
- [ ] ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒã‚§ãƒƒã‚¯é–¢æ•°
```

### ãƒ•ã‚§ãƒ¼ã‚º2: åŸºæœ¬ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
```typescript
// 3. GameEngineã®å®Ÿè£…
- [ ] 9ãƒã‚¹ç§»å‹•ãƒ­ã‚¸ãƒƒã‚¯
- [ ] å‹æ•—åˆ¤å®š
- [ ] éšå±¤é€²è¡Œ

// 4. AIEngineã®å®Ÿè£…
- [ ] Easy AI
- [ ] Normal AI
- [ ] Hard AI
```

### ãƒ•ã‚§ãƒ¼ã‚º3: UIå®Ÿè£…
```typescript
// 5. ç”»é¢å®Ÿè£…
- [ ] HomeScreen
- [ ] GameScreen
- [ ] ResultScreen

// 6. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [ ] GridBoard
- [ ] BeatIndicator
```

---

## é–‹ç™ºTips

### Cursoræ´»ç”¨

```
# è‰¯ã„æŒ‡ç¤ºä¾‹
ã€ŒBeatEngine.tsã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
- Expo AVã‚’ä½¿ç”¨ã—ã¦BGMå†ç”Ÿ
- BPMã‹ã‚‰ ãƒ“ãƒ¼ãƒˆé–“éš”ã‚’è¨ˆç®—
- ãƒ“ãƒ¼ãƒˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè£…
- ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¤å®š(Â±15%ã®èª¤å·®è¨±å®¹)
TypeScriptã§è¨˜è¿°ã€
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. éŸ³æ¥½åŒæœŸã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…(æœ€å„ªå…ˆ)
2. åŸºæœ¬ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
3. UIå®Ÿè£…
4. ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ»èª¿æ•´

---

**Escape Nine: Endless**
é–‹ç™ºé–‹å§‹æ—¥: 2025-11-13
é–‹ç™ºè€…: Souatou

Happy Coding! ğŸ®ğŸµ
